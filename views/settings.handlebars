<div class="row">
  <div class="col-md-12">
    <h2>Customize your Dashboard {{user.email}}!</h2>
  </div>
</div>

{{!-- News Feeds --}}
<div class="form-check">
  <input class="form-check-input" type="checkbox" value="" id="cnn">
  <label class="form-check-label" for="cnn">
    CNN
  </label>
</div>

{{!-- NYT --}}
<div class="form-check">
  <input class="form-check-input" type="checkbox" data-associatedtextbox="nyt-input" value="" id="nyt">
  <label class="form-check-label" for="nyt">
    New York Times
  </label>
</div>
{{!-- TEXT BOX FOR NYT --}}
<div id="nyt-text-form" class="form-group hidden">
  <label for="nyt-keyword">News Topic</label>
  <input type="email" class="form-control" id="nyt-input" placeholder="Keyword for news search">
</div>


{{!-- Personal Info --}}
<div class="form-check">
  <input class="form-check-input" type="checkbox" value="" id="weather">
  <label class="form-check-label" for="weather">
    Weather
  </label>
</div>


{{!-- Fun --}}
<div class="form-check">
  <input class="form-check-input" type="checkbox" data-associatedtextbox="spotify-input" value="" id="spotify">
  <label class="form-check-label" for="spotify">
    Spotify
  </label>
</div>

{{!-- INPUT BOX FOR SPOTIFY --}}
<div id="spotify-text-form" class="form-group hidden">
  <label for="spotify-song">Song to Include</label>
  <input type="text" class="form-control" id="spotify-input" placeholder="Song title, artist">
</div>

<div class="form-check">
  <input class="form-check-input" type="checkbox" value="" id="giphy">
  <label class="form-check-label" for="giphy">
    Giphy
  </label>
</div>

{{!-- Add static links --}}
<div class="form-check">
  <input class="form-check-input" type="checkbox" value="" data-static-links="true" id="static-links">
  <label class="form-check-label" for="static-links">
    Add static-links
  </label>
</div>

{{!-- Static link input box --}}
<div id="static-text-form" class="form-group hidden">
  <div id="add-links-div">
    <input type="text" class="form-control" id="static-input-1" placeholder="Input static link URL">
  </div>
  <button class="btn btn-primary" id="add-link-btn">+</button>
</div>


{{!-- FUTURE DEVELOPMENT --}}

{{!-- <div class="form-check">
  <input class="form-check-input" type="checkbox" value="" id="live-stream">
  <label class="form-check-label" for="live-stream">
    Live Stream - San Diego Zoo Pandas
  </label>
</div> --}}
{{!-- <div class="form-check">
  <input class="form-check-input" type="checkbox" value="" id="user-iot" >
  <label class="form-check-label" for="user-iot">
    Connect your own devices
  </label>
</div> --}}
{{!-- <div class="form-check">
  <input class="form-check-input" type="checkbox" value="" id="to-do">
  <label class="form-check-label" for="to-do">
    To-do list
  </label>
</div> --}}

{{!-- Submit Button --}}
<button class="btn btn-primary" id="save-btn">Save Selections</button>

<script>
  const nytimesBtn = document.getElementById('nyt');
  const nytTextForm = document.getElementById('nyt-text-form');
  const spotifyBtn = document.getElementById('spotify');
  const spotifyTextForm = document.getElementById('spotify-text-form');
  const staticBtn = document.getElementById('static-links');
  const staticTextForm = document.getElementById('static-text-form');
  let linkCounter = 2;

  nytimesBtn.addEventListener('change', (e) => {
    if (nytTextForm.classList.contains('hidden')) {
      nytTextForm.classList.remove('hidden')
    } else {
      nytTextForm.classList.add('hidden')
    }
  });

  spotifyBtn.addEventListener('change', (e) => {
    if (spotifyTextForm.classList.contains('hidden')) {
      spotifyTextForm.classList.remove('hidden');
    } else {
      spotifyTextForm.classList.add('hidden');
    }
  });

  staticBtn.addEventListener('change', (e) => {
    if (staticTextForm.classList.contains('hidden')) {
      staticTextForm.classList.remove('hidden');
    } else {
      staticTextForm.classList.add('hidden');
    }
  });

  $("#add-link-btn").on("click", function (e) {
    // create a new input form and append to page
    $("#add-links-div").append(`<input type="text" class="form-control" id="static-input-${linkCounter}" placeholder="Input static link URL">`)
    linkCounter++;

  })

  $("#save-btn").on("click", (e) => {
    e.preventDefault();
    // capture what has been clicked on 
    // send name of buttons that are checked to true as an object

    let settingsArr = [];

    // loop through the form, and see if each option is selected 
    $('input[type=checkbox').each(function () {
      if (this.checked) {
        console.log(this)
        let settingsObj = {
          id: this.id
        }

        // add text/keywords to obj in settingsArr
        if ($(this).data("associatedtextbox")) {
          console.log()
          settingsObj.textInfo = $(`#${$(this).data("associatedtextbox")}`).val();
        }
        
        if ($(this).data("static-links")) {
          settingsObj.urls = [];
           $("#add-links-div").children().each(function () {            
          settingsObj.urls.push($(this).val()) 
        })
        console.log(settingsObj);
        }
        
        settingsArr.push(settingsObj);
      }




    });
    console.log(settingsArr);

    // POST our data to 
    $.ajax({
      url: "/api/settings",
      method: "POST",
      data: {
        data: JSON.stringify(settingsArr)
      }
    }).then(res => {
      // console.log(res);
      window.location.href = "/box-layout";
    })

  });


</script>